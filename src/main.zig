const std = @import("std");
const string = []const u8;
const x86 = @import("x86");

fn Cases2(comptime baseaddr_str: string, comptime hex_long: string, comptime asm_expected: string) type {
    return struct {
        // hex -> asm
        test {
            const baseaddr = try std.fmt.parseUnsigned(u64, baseaddr_str, 16);
            const hex = comptime blk: {
                var result: []const u8 = &.{};
                var iter = std.mem.window(u8, std.mem.trimRight(u8, hex_long, " "), 2, 2);
                while (iter.next()) |item| {
                    result = result ++ &[_]u8{try std.fmt.parseInt(u8, item, 16)};
                }
                break :blk result;
            };
            var fbs = std.io.fixedBufferStream(hex);
            const iter = x86.BytesToInstructionIter.init(fbs.reader());
            const instr = try iter.next();
            const allocator = std.testing.allocator;
            var list = std.ArrayList(u8).init(allocator);
            defer list.deinit();
            try instr.?.renderNasm(baseaddr, list.writer());
            try std.testing.expectEqualStrings(asm_expected, list.items);
            try std.testing.expect((try iter.next()) == null);
        }

        // hex -> hex
        // test {
        // }

        // asm -> hex
        // test {
        // }

        // asm -> asm
        // test {
        // }
    };
}

// zig fmt: off

comptime { _ = Cases2("00000003", "8B442410        ", "mov eax,[esp+0x10]"); }
comptime { _ = Cases2("00000007", "03442414        ", "add eax,[esp+0x14]"); }
comptime { _ = Cases2("00000010", "C3              ", "ret"); }
comptime { _ = Cases2("00000011", "C744240400000000", "mov dword [esp+0x4],0x0"); }
comptime { _ = Cases2("00000019", "B925000000      ", "mov ecx,0x25"); }
comptime { _ = Cases2("0000001E", "BA10000000      ", "mov edx,0x10"); }
comptime { _ = Cases2("00000028", "90              ", "nop"); }
comptime { _ = Cases2("00000029", "90              ", "nop"); }
comptime { _ = Cases2("0000002A", "90              ", "nop"); }
comptime { _ = Cases2("0000002B", "90              ", "nop"); }
comptime { _ = Cases2("0000002C", "90              ", "nop"); }
comptime { _ = Cases2("0000002D", "90              ", "nop"); }
comptime { _ = Cases2("0000002E", "90              ", "nop"); }
comptime { _ = Cases2("0000002F", "90              ", "nop"); }
comptime { _ = Cases2("00000030", "55              ", "push ebp"); }
comptime { _ = Cases2("00000031", "53              ", "push ebx"); }
comptime { _ = Cases2("00000032", "57              ", "push edi"); }
comptime { _ = Cases2("00000033", "56              ", "push esi"); }
comptime { _ = Cases2("000000CD", "C3              ", "ret"); }
comptime { _ = Cases2("0000010D", "90              ", "nop"); }
comptime { _ = Cases2("0000010E", "90              ", "nop"); }
comptime { _ = Cases2("0000010F", "90              ", "nop"); }
comptime { _ = Cases2("00000110", "53              ", "push ebx"); }
comptime { _ = Cases2("00000111", "57              ", "push edi"); }
comptime { _ = Cases2("00000112", "56              ", "push esi"); }
comptime { _ = Cases2("000001EA", "C3              ", "ret"); }
comptime { _ = Cases2("00000233", "90              ", "nop"); }
comptime { _ = Cases2("00000234", "90              ", "nop"); }
comptime { _ = Cases2("00000235", "90              ", "nop"); }
comptime { _ = Cases2("00000236", "90              ", "nop"); }
comptime { _ = Cases2("00000237", "90              ", "nop"); }
comptime { _ = Cases2("00000238", "90              ", "nop"); }
comptime { _ = Cases2("00000239", "90              ", "nop"); }
comptime { _ = Cases2("0000023A", "90              ", "nop"); }
comptime { _ = Cases2("0000023B", "90              ", "nop"); }
comptime { _ = Cases2("0000023C", "90              ", "nop"); }
comptime { _ = Cases2("0000023D", "90              ", "nop"); }
comptime { _ = Cases2("0000023E", "90              ", "nop"); }
comptime { _ = Cases2("0000023F", "90              ", "nop"); }
comptime { _ = Cases2("00000248", "90              ", "nop"); }
comptime { _ = Cases2("00000249", "90              ", "nop"); }
comptime { _ = Cases2("0000024A", "90              ", "nop"); }
comptime { _ = Cases2("0000024B", "90              ", "nop"); }
comptime { _ = Cases2("0000024C", "90              ", "nop"); }
comptime { _ = Cases2("0000024D", "90              ", "nop"); }
comptime { _ = Cases2("0000024E", "90              ", "nop"); }
comptime { _ = Cases2("0000024F", "90              ", "nop"); }
comptime { _ = Cases2("00000250", "55              ", "push ebp"); }
comptime { _ = Cases2("00000251", "53              ", "push ebx"); }
comptime { _ = Cases2("00000252", "57              ", "push edi"); }
comptime { _ = Cases2("00000253", "56              ", "push esi"); }
comptime { _ = Cases2("0000027C", "55              ", "push ebp"); }
comptime { _ = Cases2("00000378", "C3              ", "ret"); }
comptime { _ = Cases2("000003BE", "90              ", "nop"); }
comptime { _ = Cases2("000003BF", "90              ", "nop"); }
comptime { _ = Cases2("000003C0", "55              ", "push ebp"); }
comptime { _ = Cases2("000003C1", "53              ", "push ebx"); }
comptime { _ = Cases2("000003C2", "57              ", "push edi"); }
comptime { _ = Cases2("000003C3", "56              ", "push esi"); }
comptime { _ = Cases2("000003FC", "90              ", "nop"); }
comptime { _ = Cases2("000003FD", "90              ", "nop"); }
comptime { _ = Cases2("000003FE", "90              ", "nop"); }
comptime { _ = Cases2("000003FF", "90              ", "nop"); }
comptime { _ = Cases2("0000041B", "90              ", "nop"); }
comptime { _ = Cases2("0000041C", "90              ", "nop"); }
comptime { _ = Cases2("0000041D", "90              ", "nop"); }
comptime { _ = Cases2("0000041E", "90              ", "nop"); }
comptime { _ = Cases2("0000041F", "90              ", "nop"); }
comptime { _ = Cases2("00000484", "C3              ", "ret"); }
comptime { _ = Cases2("000004B3", "90              ", "nop"); }
comptime { _ = Cases2("000004B4", "90              ", "nop"); }
comptime { _ = Cases2("000004B5", "90              ", "nop"); }
comptime { _ = Cases2("000004B6", "90              ", "nop"); }
comptime { _ = Cases2("000004B7", "90              ", "nop"); }
comptime { _ = Cases2("000004B8", "90              ", "nop"); }
comptime { _ = Cases2("000004B9", "90              ", "nop"); }
comptime { _ = Cases2("000004BA", "90              ", "nop"); }
comptime { _ = Cases2("000004BB", "90              ", "nop"); }
comptime { _ = Cases2("000004BC", "90              ", "nop"); }
comptime { _ = Cases2("000004BD", "90              ", "nop"); }
comptime { _ = Cases2("000004BE", "90              ", "nop"); }
comptime { _ = Cases2("000004BF", "90              ", "nop"); }
comptime { _ = Cases2("000004C0", "53              ", "push ebx"); }
comptime { _ = Cases2("000004C1", "56              ", "push esi"); }
comptime { _ = Cases2("00000517", "C3              ", "ret"); }
comptime { _ = Cases2("00000533", "C3              ", "ret"); }
comptime { _ = Cases2("0000054E", "90              ", "nop"); }
comptime { _ = Cases2("0000054F", "90              ", "nop"); }
comptime { _ = Cases2("00000594", "53              ", "push ebx"); }
comptime { _ = Cases2("00000595", "56              ", "push esi"); }
comptime { _ = Cases2("000005B9", "C3              ", "ret"); }
comptime { _ = Cases2("000005BC", "90              ", "nop"); }
comptime { _ = Cases2("000005BD", "90              ", "nop"); }
comptime { _ = Cases2("000005BE", "90              ", "nop"); }
comptime { _ = Cases2("000005BF", "90              ", "nop"); }
comptime { _ = Cases2("000005C0", "55              ", "push ebp"); }
comptime { _ = Cases2("000005C1", "53              ", "push ebx"); }
comptime { _ = Cases2("000005C2", "57              ", "push edi"); }
comptime { _ = Cases2("000005C3", "56              ", "push esi"); }
comptime { _ = Cases2("000005EA", "90              ", "nop"); }
comptime { _ = Cases2("000005EB", "90              ", "nop"); }
comptime { _ = Cases2("000005EC", "90              ", "nop"); }
comptime { _ = Cases2("000005ED", "90              ", "nop"); }
comptime { _ = Cases2("000005EE", "90              ", "nop"); }
comptime { _ = Cases2("000005EF", "90              ", "nop"); }
comptime { _ = Cases2("00000698", "C3              ", "ret"); }
comptime { _ = Cases2("000006B0", "55              ", "push ebp"); }
comptime { _ = Cases2("000006B1", "53              ", "push ebx"); }
comptime { _ = Cases2("000006B2", "57              ", "push edi"); }
comptime { _ = Cases2("000006B3", "56              ", "push esi"); }
comptime { _ = Cases2("00000701", "90              ", "nop"); }
comptime { _ = Cases2("00000702", "90              ", "nop"); }
comptime { _ = Cases2("00000703", "90              ", "nop"); }
comptime { _ = Cases2("00000704", "90              ", "nop"); }
comptime { _ = Cases2("00000705", "90              ", "nop"); }
comptime { _ = Cases2("00000706", "90              ", "nop"); }
comptime { _ = Cases2("00000707", "90              ", "nop"); }
comptime { _ = Cases2("00000708", "90              ", "nop"); }
comptime { _ = Cases2("00000709", "90              ", "nop"); }
comptime { _ = Cases2("0000070A", "90              ", "nop"); }
comptime { _ = Cases2("0000070B", "90              ", "nop"); }
comptime { _ = Cases2("0000070C", "90              ", "nop"); }
comptime { _ = Cases2("0000070D", "90              ", "nop"); }
comptime { _ = Cases2("0000070E", "90              ", "nop"); }
comptime { _ = Cases2("0000070F", "90              ", "nop"); }
comptime { _ = Cases2("00000723", "90              ", "nop"); }
comptime { _ = Cases2("00000724", "90              ", "nop"); }
comptime { _ = Cases2("00000725", "90              ", "nop"); }
comptime { _ = Cases2("00000726", "90              ", "nop"); }
comptime { _ = Cases2("00000727", "90              ", "nop"); }
comptime { _ = Cases2("00000728", "90              ", "nop"); }
comptime { _ = Cases2("00000729", "90              ", "nop"); }
comptime { _ = Cases2("0000072A", "90              ", "nop"); }
comptime { _ = Cases2("0000072B", "90              ", "nop"); }
comptime { _ = Cases2("0000072C", "90              ", "nop"); }
comptime { _ = Cases2("0000072D", "90              ", "nop"); }
comptime { _ = Cases2("0000072E", "90              ", "nop"); }
comptime { _ = Cases2("0000072F", "90              ", "nop"); }
comptime { _ = Cases2("0000075D", "90              ", "nop"); }
comptime { _ = Cases2("0000075E", "90              ", "nop"); }
comptime { _ = Cases2("0000075F", "90              ", "nop"); }
comptime { _ = Cases2("000007A1", "90              ", "nop"); }
comptime { _ = Cases2("000007A2", "90              ", "nop"); }
comptime { _ = Cases2("000007A3", "90              ", "nop"); }
comptime { _ = Cases2("000007A4", "90              ", "nop"); }
comptime { _ = Cases2("000007A5", "90              ", "nop"); }
comptime { _ = Cases2("000007A6", "90              ", "nop"); }
comptime { _ = Cases2("000007A7", "90              ", "nop"); }
comptime { _ = Cases2("000007A8", "90              ", "nop"); }
comptime { _ = Cases2("000007A9", "90              ", "nop"); }
comptime { _ = Cases2("000007AA", "90              ", "nop"); }
comptime { _ = Cases2("000007AB", "90              ", "nop"); }
comptime { _ = Cases2("000007AC", "90              ", "nop"); }
comptime { _ = Cases2("000007AD", "90              ", "nop"); }
comptime { _ = Cases2("000007AE", "90              ", "nop"); }
comptime { _ = Cases2("000007AF", "90              ", "nop"); }
comptime { _ = Cases2("000007DB", "90              ", "nop"); }
comptime { _ = Cases2("000007DC", "90              ", "nop"); }
comptime { _ = Cases2("000007DD", "90              ", "nop"); }
comptime { _ = Cases2("000007DE", "90              ", "nop"); }
comptime { _ = Cases2("000007DF", "90              ", "nop"); }
comptime { _ = Cases2("00000921", "90              ", "nop"); }
comptime { _ = Cases2("00000922", "90              ", "nop"); }
comptime { _ = Cases2("00000923", "90              ", "nop"); }
comptime { _ = Cases2("00000924", "90              ", "nop"); }
comptime { _ = Cases2("00000925", "90              ", "nop"); }
comptime { _ = Cases2("00000926", "90              ", "nop"); }
comptime { _ = Cases2("00000927", "90              ", "nop"); }
comptime { _ = Cases2("00000928", "90              ", "nop"); }
comptime { _ = Cases2("00000929", "90              ", "nop"); }
comptime { _ = Cases2("0000092A", "90              ", "nop"); }
comptime { _ = Cases2("0000092B", "90              ", "nop"); }
comptime { _ = Cases2("0000092C", "90              ", "nop"); }
comptime { _ = Cases2("0000092D", "90              ", "nop"); }
comptime { _ = Cases2("0000092E", "90              ", "nop"); }
comptime { _ = Cases2("0000092F", "90              ", "nop"); }
comptime { _ = Cases2("0000098C", "90              ", "nop"); }
comptime { _ = Cases2("0000098D", "90              ", "nop"); }
comptime { _ = Cases2("0000098E", "90              ", "nop"); }
comptime { _ = Cases2("0000098F", "90              ", "nop"); }
comptime { _ = Cases2("00000A43", "90              ", "nop"); }
comptime { _ = Cases2("00000A44", "90              ", "nop"); }
comptime { _ = Cases2("00000A45", "90              ", "nop"); }
comptime { _ = Cases2("00000A46", "90              ", "nop"); }
comptime { _ = Cases2("00000A47", "90              ", "nop"); }
comptime { _ = Cases2("00000A48", "90              ", "nop"); }
comptime { _ = Cases2("00000A49", "90              ", "nop"); }
comptime { _ = Cases2("00000A4A", "90              ", "nop"); }
comptime { _ = Cases2("00000A4B", "90              ", "nop"); }
comptime { _ = Cases2("00000A4C", "90              ", "nop"); }
comptime { _ = Cases2("00000A4D", "90              ", "nop"); }
comptime { _ = Cases2("00000A4E", "90              ", "nop"); }
comptime { _ = Cases2("00000A4F", "90              ", "nop"); }
comptime { _ = Cases2("00000AA8", "90              ", "nop"); }
comptime { _ = Cases2("00000AA9", "90              ", "nop"); }
comptime { _ = Cases2("00000AAA", "90              ", "nop"); }
comptime { _ = Cases2("00000AAB", "90              ", "nop"); }
comptime { _ = Cases2("00000AAC", "90              ", "nop"); }
comptime { _ = Cases2("00000AAD", "90              ", "nop"); }
comptime { _ = Cases2("00000AAE", "90              ", "nop"); }
comptime { _ = Cases2("00000AAF", "90              ", "nop"); }
comptime { _ = Cases2("00000B7F", "90              ", "nop"); }
comptime { _ = Cases2("00000BFD", "C3              ", "ret"); }
comptime { _ = Cases2("00000C8B", "90              ", "nop"); }
comptime { _ = Cases2("00000C8C", "90              ", "nop"); }
comptime { _ = Cases2("00000C8D", "90              ", "nop"); }
comptime { _ = Cases2("00000C8E", "90              ", "nop"); }
comptime { _ = Cases2("00000C8F", "90              ", "nop"); }
comptime { _ = Cases2("00000C90", "53              ", "push ebx"); }
comptime { _ = Cases2("00000CB7", "90              ", "nop"); }
comptime { _ = Cases2("00000CB8", "90              ", "nop"); }
comptime { _ = Cases2("00000CB9", "90              ", "nop"); }
comptime { _ = Cases2("00000CBA", "90              ", "nop"); }
comptime { _ = Cases2("00000CBB", "90              ", "nop"); }
comptime { _ = Cases2("00000CBC", "90              ", "nop"); }
comptime { _ = Cases2("00000CBD", "90              ", "nop"); }
comptime { _ = Cases2("00000CBE", "90              ", "nop"); }
comptime { _ = Cases2("00000CBF", "90              ", "nop"); }
comptime { _ = Cases2("00000CC0", "55              ", "push ebp"); }
comptime { _ = Cases2("00000CC1", "53              ", "push ebx"); }
comptime { _ = Cases2("00000CC2", "57              ", "push edi"); }
comptime { _ = Cases2("00000CC3", "56              ", "push esi"); }
comptime { _ = Cases2("00000D64", "C3              ", "ret"); }
comptime { _ = Cases2("00000DFB", "90              ", "nop"); }
comptime { _ = Cases2("00000DFC", "90              ", "nop"); }
comptime { _ = Cases2("00000DFD", "90              ", "nop"); }
comptime { _ = Cases2("00000DFE", "90              ", "nop"); }
comptime { _ = Cases2("00000DFF", "90              ", "nop"); }
comptime { _ = Cases2("00000E09", "90              ", "nop"); }
comptime { _ = Cases2("00000E0A", "90              ", "nop"); }
comptime { _ = Cases2("00000E0B", "90              ", "nop"); }
comptime { _ = Cases2("00000E0C", "90              ", "nop"); }
comptime { _ = Cases2("00000E0D", "90              ", "nop"); }
comptime { _ = Cases2("00000E0E", "90              ", "nop"); }
comptime { _ = Cases2("00000E0F", "90              ", "nop"); }
comptime { _ = Cases2("00000E19", "90              ", "nop"); }
comptime { _ = Cases2("00000E1A", "90              ", "nop"); }
comptime { _ = Cases2("00000E1B", "90              ", "nop"); }
comptime { _ = Cases2("00000E1C", "90              ", "nop"); }
comptime { _ = Cases2("00000E1D", "90              ", "nop"); }
comptime { _ = Cases2("00000E1E", "90              ", "nop"); }
comptime { _ = Cases2("00000E1F", "90              ", "nop"); }
comptime { _ = Cases2("00000E20", "53              ", "push ebx"); }
comptime { _ = Cases2("00000E21", "57              ", "push edi"); }
comptime { _ = Cases2("00000E22", "56              ", "push esi"); }
comptime { _ = Cases2("00000EC2", "C3              ", "ret"); }
comptime { _ = Cases2("00000EF1", "90              ", "nop"); }
comptime { _ = Cases2("00000EF2", "90              ", "nop"); }
comptime { _ = Cases2("00000EF3", "90              ", "nop"); }
comptime { _ = Cases2("00000EF4", "90              ", "nop"); }
comptime { _ = Cases2("00000EF5", "90              ", "nop"); }
comptime { _ = Cases2("00000EF6", "90              ", "nop"); }
comptime { _ = Cases2("00000EF7", "90              ", "nop"); }
comptime { _ = Cases2("00000EF8", "90              ", "nop"); }
comptime { _ = Cases2("00000EF9", "90              ", "nop"); }
comptime { _ = Cases2("00000EFA", "90              ", "nop"); }
comptime { _ = Cases2("00000EFB", "90              ", "nop"); }
comptime { _ = Cases2("00000EFC", "90              ", "nop"); }
comptime { _ = Cases2("00000EFD", "90              ", "nop"); }
comptime { _ = Cases2("00000EFE", "90              ", "nop"); }
comptime { _ = Cases2("00000EFF", "90              ", "nop"); }
comptime { _ = Cases2("00000F00", "53              ", "push ebx"); }
comptime { _ = Cases2("00000F5F", "C3              ", "ret"); }
comptime { _ = Cases2("00000FB0", "53              ", "push ebx"); }
comptime { _ = Cases2("00000FF0", "C3              ", "ret"); }
comptime { _ = Cases2("00001041", "90              ", "nop"); }
comptime { _ = Cases2("00001042", "90              ", "nop"); }
comptime { _ = Cases2("00001043", "90              ", "nop"); }
comptime { _ = Cases2("00001044", "90              ", "nop"); }
comptime { _ = Cases2("00001045", "90              ", "nop"); }
comptime { _ = Cases2("00001046", "90              ", "nop"); }
comptime { _ = Cases2("00001047", "90              ", "nop"); }
comptime { _ = Cases2("00001048", "90              ", "nop"); }
comptime { _ = Cases2("00001049", "90              ", "nop"); }
comptime { _ = Cases2("0000104A", "90              ", "nop"); }
comptime { _ = Cases2("0000104B", "90              ", "nop"); }
comptime { _ = Cases2("0000104C", "90              ", "nop"); }
comptime { _ = Cases2("0000104D", "90              ", "nop"); }
comptime { _ = Cases2("0000104E", "90              ", "nop"); }
comptime { _ = Cases2("0000104F", "90              ", "nop"); }
comptime { _ = Cases2("00001050", "55              ", "push ebp"); }
comptime { _ = Cases2("00001051", "53              ", "push ebx"); }
comptime { _ = Cases2("00001052", "57              ", "push edi"); }
comptime { _ = Cases2("00001053", "56              ", "push esi"); }
comptime { _ = Cases2("000011ED", "90              ", "nop"); }
comptime { _ = Cases2("000011EE", "90              ", "nop"); }
comptime { _ = Cases2("000011EF", "90              ", "nop"); }
comptime { _ = Cases2("000012AC", "C3              ", "ret"); }
comptime { _ = Cases2("000012F2", "90              ", "nop"); }
comptime { _ = Cases2("000012F3", "90              ", "nop"); }
comptime { _ = Cases2("000012F4", "90              ", "nop"); }
comptime { _ = Cases2("000012F5", "90              ", "nop"); }
comptime { _ = Cases2("000012F6", "90              ", "nop"); }
comptime { _ = Cases2("000012F7", "90              ", "nop"); }
comptime { _ = Cases2("000012F8", "90              ", "nop"); }
comptime { _ = Cases2("000012F9", "90              ", "nop"); }
comptime { _ = Cases2("000012FA", "90              ", "nop"); }
comptime { _ = Cases2("000012FB", "90              ", "nop"); }
comptime { _ = Cases2("000012FC", "90              ", "nop"); }
comptime { _ = Cases2("000012FD", "90              ", "nop"); }
comptime { _ = Cases2("000012FE", "90              ", "nop"); }
comptime { _ = Cases2("000012FF", "90              ", "nop"); }
comptime { _ = Cases2("00001300", "57              ", "push edi"); }
comptime { _ = Cases2("00001301", "56              ", "push esi"); }
comptime { _ = Cases2("00001359", "C3              ", "ret"); }
comptime { _ = Cases2("00001388", "90              ", "nop"); }
comptime { _ = Cases2("00001389", "90              ", "nop"); }
comptime { _ = Cases2("0000138A", "90              ", "nop"); }
comptime { _ = Cases2("0000138B", "90              ", "nop"); }
comptime { _ = Cases2("0000138C", "90              ", "nop"); }
comptime { _ = Cases2("0000138D", "90              ", "nop"); }
comptime { _ = Cases2("0000138E", "90              ", "nop"); }
comptime { _ = Cases2("0000138F", "90              ", "nop"); }
comptime { _ = Cases2("00001390", "55              ", "push ebp"); }
comptime { _ = Cases2("00001391", "53              ", "push ebx"); }
comptime { _ = Cases2("00001392", "57              ", "push edi"); }
comptime { _ = Cases2("00001393", "56              ", "push esi"); }
comptime { _ = Cases2("000013F5", "C3              ", "ret"); }
comptime { _ = Cases2("0000143F", "90              ", "nop"); }
comptime { _ = Cases2("00001440", "57              ", "push edi"); }
comptime { _ = Cases2("00001441", "56              ", "push esi"); }
comptime { _ = Cases2("00001479", "C3              ", "ret"); }
